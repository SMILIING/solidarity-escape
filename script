<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Solidarity Escape Game</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
  <style>
    body { margin: 0; padding: 0; }
    canvas { display: block; margin: auto; }
  </style>
</head>
<body>
<script>
// Boot scene
class BootScene extends Phaser.Scene {
  constructor() { super('BootScene'); }
  preload() {
    console.log('Preloading assets...');
    this.load.image('circle', 'https://i.imgur.com/OQ8f1jG.png');
    this.load.audio('click', 'https://freesound.org/data/previews/256/256113_3263906-lq.mp3');
  }
  create() {
    console.log('Starting WebRoom scene...');
    this.scene.start('WebRoom');
  }
}

// Web room scene
class WebRoom extends Phaser.Scene {
  constructor() { super('WebRoom'); }
  create() {
    console.log('Create WebRoom');
    this.sound.add('click');
    this.circles = this.add.group();
    for (let i = 0; i < 6; i++) {
      let x = 100 + i * 100, y = 300;
      console.log('Creating circle at', x, y);
      let c = this.add.image(x, y, 'circle').setInteractive();
      c.on('pointerdown', () => this.untangle(c));
      this.circles.add(c);
    }
  }
  untangle(c) {
    console.log('Circle clicked', c);
    this.sound.play('click');
    c.destroy();
    if (this.circles.countActive() === 0) {
      console.log('All circles untangled â€” game complete!');
      this.add.text(200, 550, 'ðŸŽ‰ You escaped with code: A', { font: '24px Arial', fill: '#fff' });
      this.time.delayedCall(2000, () => this.scene.start('FinalScene'));
    }
  }
}

// Final scene
class FinalScene extends Phaser.Scene {
  constructor() { super('FinalScene'); }
  create() {
    console.log('Enter FinalScene');
    this.add.text(200, 300, 'Congratulations! Youâ€™ve escaped!', { font: '32px Arial', fill: '#0f0' });
  }
}

// Game config
console.log('Initializing Phaser game');
const config = {
  type: Phaser.AUTO,
  width: 800,
  height: 600,
  backgroundColor: '#333',
  scene: [BootScene, WebRoom, FinalScene],
  audio: { disableWebAudio: false }
};
new Phaser.Game(config);
</script>
</body>
</html>
